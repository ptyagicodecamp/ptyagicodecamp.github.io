<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="This post shows how to automate Android App publishing to Play Store using Jenkins on Mac OSX 10.12.3 and Jenkins 2.46." />

    <meta name="author" content="ptyagi" />
    <meta name="copyright" content="ptyagi" />


        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<title>Automating Android App publishing to Play Store  using Jenkins - </title>

    <!-- iPython Notebook script -->
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
            <script type="text/javascript">
            init_mathjax = function() {
                if (window.MathJax) {
                    // MathJax loaded
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                            displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                        },
                        displayAlign: 'left', // Change this to 'center' to center equations.
                        "HTML-CSS": {
                            styles: {'.MathJax_Display': {"margin": 0}}
                        }
                    });
                    MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
                }
            }
            init_mathjax();
        </script>
      <!--Import jQuery before materialize.js-->
      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

      <!-- iPython Notebook script for collapsing and expanding code -->
        <script type="text/javascript">
        jQuery(document).ready(function($) {
            $("div.collapseheader").click(function () {
            $header = $(this).children("span").first();
            $codearea = $(this).children(".input_area");
            console.log($(this).children());
            $codearea.slideToggle(500, function () {
                $header.text(function () {
                    return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
                });
            });
        });
        });
        </script>
        <script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
    <!-- Bootstrap Core CSS -->
    <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

         <!-- Compiled and minified CSS -->
     <link rel="stylesheet" href="/theme/css/materialize.min.css">

     <!-- Compiled and minified JavaScript -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.0/js/materialize.min.js"></script>

    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    <link href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="/theme/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Arvo" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Permanent+Marker|Pacifico|Nova+Round|EB+Garamond|Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lobster+Two' rel='stylesheet' type='text/css'>
    <!-- Custom CSS -->
    <link href="/theme/css/pelican-smoothie.css" rel="stylesheet">
    <link href="/theme/css/pygment.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/tipuesearch/tipuesearch.css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


<script>
    mixpanel.track("Page", {"Name": "Automating Android App publishing to Play Store  using Jenkins", "url": "automating-android-app-publishing-to-play-store-using-jenkins.html"  }) ;
</script>
</head>

<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

   <div class="search-button">
            <form id="search" class="floating-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);">
            <input type="search" class="search-query" placeholder="Search" name="q"></form>
       </div>




    <div class="content-block">

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="intro-header-article" style="background-image: url('');">
        <div class="intro-body">
            <div class="container">
                <div class="row">
                    <div class="col-sm-2 fixed-action-btn">
                    <a href='/blog' class="btn-floating btn-large white page-scroll">
                      <i class="md-dark material-icons">keyboard_arrow_left</i>
                    </a>
                    </div>
                    <div class="col-sm-10 col-sm-offset-1">
                    <h1 class="article-heading">Automating Android App publishing to Play Store  using Jenkins</h1>
                        <h2 class="article-subheading"> </h2>
<span class="meta last-updated">
Published on 
<time pubdate="pubdate" datetime="2017-02-23T12:02:00-07:00">Feb 23, 2017</time>
</span>                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-10 col-lg-offset-1">
                    <div class="entry-content">
                    <h3>Introduction</h3>
<p>This article describes the journey I took from setting up Jenkins to automate publishing Android APKs to Google Play Publishing portal and useful notes that I collected along the way. I set up Jenkins-2.46 on Mac OSX 10.12.3.</p>
<h4>Download Package</h4>
<p>You can download “.pkg” file from <a href="http://mirrors.jenkins.io/osx/latest">here</a></p>
<h4>Complete Installation</h4>
<p>Follow the instructions to complete installation.
<img alt="Alt installation" src="../images/jenkins/installation.png"></p>
<p><strong>Note:</strong> You’ll be asked to enter an additional password like below to ensure the security:
<br>
<img alt="Alt installation2" src="../images/jenkins/installation-2.png"></p>
<h4>Choosing Plugins</h4>
<p>You can go with default plugins unless you know what plugins you want to install. I'll cover other plugins, if needed as their need arises.</p>
<h4>Starting Jenkins</h4>
<p>Once installation is complete, you can type  <a href="http://localhost:8080">http://localhost:8080</a> in your browser to start jenkins server. It’ll ask for temporary password it created at : /Users/Shared/Jenkins/Home/secrets/initialAdminPassword</p>
<p>This is how it will look like:
<img alt="Alt starting" src="../images/jenkins/starting.png"></p>
<p><strong>Note:</strong> Unless you’ve created an admin user explicitly, you can login as administrator using username <strong>“admin”</strong> and password created in <strong>“/Users/Shared/Jenkins/Home/secrets/initialAdminPassword”</strong> file.</p>
<p>Click on “Start Jenkins” to start creating jobs on Jenkins to automate project building and publishing.</p>
<h3>Setting up Job to Build Android project</h3>
<h4><strong>Create Jenkins Job</strong></h4>
<ol>
<li>
<p>Create a free-style project.
<img alt="Alt free-style" src="../images/jenkins/project-1.png"></p>
</li>
<li>
<p>Add Repository in <strong>Source Code Management</strong> section. You will have to provide credentials to Jenkins to access source code repository.</p>
</li>
<li>
<p>Add build specific configuration in <strong>Build</strong> section. I'll be using shell script to build my gradle based project.</p>
</li>
</ol>
<p><strong>Note:</strong> If you're running into source code repo access issues, then you may want to add credentials like this:
<img alt="Alt repo-creds" src="../images/jenkins/repo-creds.png"></p>
<h4><strong>Uploading APK to Play Store</strong></h4>
<p><strong>Setup</strong></p>
<ol>
<li>
<p>You'll need <a href="https://wiki.jenkins-ci.org/display/JENKINS/Google+Play+Android+Publisher+Plugin">Google Play Android Publisher Plugin</a> plugin to publish APKs automatically from Jenkins.</p>
</li>
<li>
<p>Navigate to localhost:8080 in your browser to get to Jenkins. Click on <strong>Manage Jenkins</strong> --&gt; <strong>Manage Plugins</strong>. Look for 'Google Play Android Publisher Plugin' by typing it in search box and install. You'll need to add service account to Jenkins as well. Refer to <a href="https://wiki.jenkins-ci.org/display/JENKINS/Google+Play+Android+Publisher+Plugin">link for detailed process</a>).</p>
</li>
<li>
<p>You'll need to enable API access from Jenkins. So, you have to be owner of your <a href="https://developer.android.com/distribute/googleplay/start.html">Google Play Publisher account</a></p>
</li>
<li>
<p>Its important to know that you must have pre-existing app in Play Store already before you could upload another incremental update via Jenkins.</p>
</li>
<li>
<p>Create Service account at Play Store publishing portal under 'API Access' category at left. It'll take you to Google project console. This is where, you'll create 'JSON' or 'p12' key to enable integration between Jenkins and Play Store publishing. Keep this key safe since you'll need this to enable Jenkins account to access Play store publishing. Also, Don't forget to grant 'Release Manager' permissions to this service account in Play store Publishing portal.</p>
</li>
<li>
<p>Go back to Jenkins, and create credentials to access Play Store. This is where you'll need to provide JSON key that you created in step above.
<img alt="Alt credentials" src="../images/jenkins/playstore-service-creds.png"></p>
</li>
</ol>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Google+Play+Android+Publisher+Plugin">Here</a> is pretty good explanation of process to setup your accounts.</p>
<p>Note 1: You can use following command on terminal to reset <code>jenkins</code> user password, if run into password related issues:</p>
<div class="highlight"><pre><span></span>sudo passwd jenkins
</pre></div>


<p>Note 2: Jenkins will need its own installation of Android sdk. Don't forget to make sure that sdk installation has <code>license</code> directory. If its not available, then copy it from you other sdk instaltion to here at first level. Check <a href="https://developer.android.com/studio/intro/update.html#download-with-gradle">this link</a> for details.</p>
<p><strong>Configuring Job</strong>
1. Add post-build action: "Upload Android APK to Google Play"
<img alt="Alt upload-apk-1" src="../images/jenkins/upload-apk-1.png"></p>
<ol>
<li>Fill-in the path or pattern to APK created locally. In my case, its <code>**/*-release.apk</code>. Also, add languages supprted and add roll-out percentage if its being pushed in production channel. I'm publishing to <code>alpha</code> channel.
<img alt="Alt upload-apk-2" src="../images/jenkins/upload-apk-2.png"></li>
</ol>
<p>And you're done !</p>
<p>For more details about configuring uploading job refer to <a href="https://wiki.jenkins-ci.org/display/JENKINS/Google+Play+Android+Publisher+Plugin">this link</a>.</p>
<p>Extra Credits:
<a href="https://wiki.jenkins-ci.org/display/JENKINS/EnvInject+Plugin">EnvInject Plugin</a> can be used to supply APK signing password to Jenkins job. Checkout <a href="https://stackoverflow.com/questions/27234506/android-build-release-apk-on-jenkins-without-storing-my-password-in-plain-text?answertab=votes#tab-top">this</a> StackOverflow answer on how to set it up.</p>
                    </div>
                </div>
            </div>
        </div>
    </article>

    <hr>

    </div>

    <!-- Footer -->
    <footer>
    <div id="footer" class="container text-center">
            </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/theme/js/jquery.easing.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/theme/js/pelican-smoothie.js"></script>
    <script type="text/javascript" src="/theme/tipuesearch/tipuesearch_set.js"></script>
    <script type="text/javascript" src="/theme/tipuesearch/tipuesearch.min.js"></script>
    <script>
    // jQuery to change FAB
    $(window).scroll(function() {
            var scroll = $(window).scrollTop();
          if (scroll > window.innerHeight/6 ) {
            $(".fixed-action-btn").addClass("scrolled");
            $(".fixed-action-btn a.btn-large").attr("href", "#page-top")
            $('.fixed-action-btn .btn-large .material-icons').text('keyboard_arrow_up');
            $('.fixed-action-btn .btn-large').addClass('customcolor');
            $('.fixed-action-btn .btn-large').removeClass('white');
            $('.fixed-action-btn a.btn-large i').addClass('md-light');
            $('.fixed-action-btn a.btn-large i').removeClass('md-dark');
        }
          if (scroll > 200 ) {
            $(".fixed-action-btn").addClass("scrolled");
            $(".fixed-action-btn a.btn-large").attr("href", "#page-top")
            $('.fixed-action-btn .btn-large .material-icons').text('keyboard_arrow_up');
            $('.fixed-action-btn .btn-large').addClass('customcolor');
            $('.fixed-action-btn .btn-large').removeClass('white');
            $('.fixed-action-btn a.btn-large i').addClass('md-light');
            $('.fixed-action-btn a.btn-large i').removeClass('md-dark');
        }
          if (scroll < window.innerHeight/6 ) {
            $(".fixed-action-btn").removeClass("scrolled");
            $(".fixed-action-btn a.btn-large").attr("href", "/blog")
            $('.fixed-action-btn .btn-large .material-icons').text('keyboard_arrow_left');
            $('.fixed-action-btn .btn-large').removeClass('customcolor');
            $('.fixed-action-btn .btn-large').addClass('white');
            $('.fixed-action-btn a.btn-large i').removeClass('md-light');
            $('.fixed-action-btn a.btn-large i').addClass('md-dark');
        }
    });
    </script>

</body>
</html>
